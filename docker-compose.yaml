services:


   cs-spawner:
    image: cs-spawner # CHANGE to an image name specific to this project
    container_name: cs-spawner
    build:
      context: .
      dockerfile: Dockerfile

    # These labels set up the domain name in the Caddy proxy
    labels:
      caddy: cs-spawner.do.jointheleague.org
      caddy.reverse_proxy: "{{upstreams 8000}}"

    environment:
      IMAGES_NOVNC: 'ghcr.io/league-infrastructure/novnc-service:v0.1.3'
      IMAGES_PYTHONCS: 'ghcr.io/league-infrastructure/league-infrastructure/docker-codeserver-python:v0.2.2'


    volumes:
      - app-data:/app/data
      - /var/run/docker.sock:/var/run/docker.sock

    # Expose Flask app on host port 8090
    ports:
      - "8090:8000"

    networks: # Must exist to recieve traffic from Caddy
      - caddy
      - jtlctl


networks:
  caddy:
    external: true
  jtlctl:


volumes:
  app-data:

